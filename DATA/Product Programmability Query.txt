CREATE PROCEDURE [dbo].[Product_Crud]
	@Action VARCHAR(10),
	@ProductId INT = NULL,
	@Name VARCHAR(100) = NULL,
	@Description VARCHAR(MAX) = NULL,
	@Price DECIMAL(18, 2) = 0,
	@Quantity INT = NULL,
	@ImageUrl VARCHAR(MAX) = NULL,
	@CategoryId INT = NULL,
	@IsActive BIT = 0
AS 
BEGIN
	SET NOCOUNT ON;

	-- SELECT
	IF @Action = 'SELECT'
	BEGIN
		SELECT p.*, c.Name AS CategoryName
		FROM dbo.Products p
		INNER JOIN dbo.Categories c ON c.CategoryId = p.CategoryId
		ORDER BY p.CreatedDate DESC;
	END

	--activeprod
	if @Action = 'activeprod'
	begin
		select p.*, c.Name as CategoryName
		from dbo.Products p
		inner join dbo.Categories c on c.CategoryId = p.CategoryId
		where p.IsActive = 1
	end

	-- INSERT
	IF @Action = 'INSERT'
	BEGIN
		INSERT INTO dbo.Products (Name, Description, Price, Quantity, ImageUrl, CategoryId, IsActive, CreatedDate)
		VALUES (@Name, @Description, @Price, @Quantity, @ImageUrl, @CategoryId, @IsActive, GETDATE());
	END

	-- UPDATE
	IF @Action = 'UPDATE'
	BEGIN	
		DECLARE @update_image VARCHAR(20);
		SELECT @update_image = (CASE WHEN @ImageUrl IS NULL THEN 'NO' ELSE 'YES' END);

		IF @update_image = 'NO'
		BEGIN
			UPDATE dbo.Products
			SET Name = @Name, Description = @Description, Price = @Price, Quantity = @Quantity,
				CategoryId = @CategoryId, IsActive = @IsActive
			WHERE ProductId = @ProductId;
		END
		ELSE
		BEGIN
			UPDATE dbo.Products
			SET Name = @Name, Description = @Description, Price = @Price, Quantity = @Quantity,
				ImageUrl = @ImageUrl, CategoryId = @CategoryId, IsActive = @IsActive
			WHERE ProductId = @ProductId;
		END
	END

	-- UPDATE QUANTITY
	IF @Action = 'QTYUPDATE'
	BEGIN
		UPDATE dbo.Products
		SET Quantity = @Quantity
		WHERE ProductId = @ProductId;
	END

	-- DELETE
	IF @Action = 'DELETE'
	begin
		delete from dbo.Products where ProductId = @ProductId;
	end

	--getbyid
	if @Action = 'getbyid'
	begin
		select * from dbo.Products where ProductId = @ProductId
	end
END
